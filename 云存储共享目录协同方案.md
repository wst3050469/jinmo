# SCMSé¡¹ç›®ï¼šäº‘å­˜å‚¨å…±äº«ç›®å½•ååŒæ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2026-02-26
- **é€‚ç”¨èŒƒå›´**: SCMSæ–½å·¥ç»¼åˆç®¡ç†ç³»ç»Ÿé¡¹ç›®
- **æ–¹æ¡ˆç±»å‹**: äº‘å­˜å‚¨å…±äº«ç›®å½•ååŒ

---

## 1. é—®é¢˜èƒŒæ™¯

### 1.1 å½“å‰é—®é¢˜
- å¼€å‘AIå’Œéƒ¨ç½²AIå¯èƒ½ä¸åœ¨åŒä¸€ä¸ªå·¥ä½œç©ºé—´è·¯å¾„
- å¼€å‘AIå£°ç§°åˆ›å»ºäº† handover/ ç›®å½•ï¼Œä½†éƒ¨ç½²AIå®é™…æ£€æŸ¥æ—¶æœªæ‰¾åˆ°
- æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸åŒæ­¥å¯¼è‡´éƒ¨ç½²æ— æ³•è§¦å‘

### 1.2 è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨äº‘å­˜å‚¨ä½œä¸ºå…±äº«ç›®å½•ï¼ŒåŒæ–¹é€šè¿‡äº‘å­˜å‚¨çš„prefixæ¥æ¨¡æ‹Ÿç›®å½•ç»“æ„ï¼Œå®ç°è·¨å·¥ä½œç©ºé—´çš„æ–‡ä»¶å…±äº«ã€‚

---

## 2. æ–¹æ¡ˆè®¾è®¡

### 2.1 äº‘å­˜å‚¨ç›®å½•ç»“æ„
```
workspace/
â””â”€â”€ projects/
    â””â”€â”€ handover/
        â”œâ”€â”€ deploy_ready_flag.txt          # éƒ¨ç½²å°±ç»ªæ ‡å¿—æ–‡ä»¶ï¼ˆç©ºæ–‡ä»¶å³å¯ï¼‰
        â”œâ”€â”€ version.txt                    # ç‰ˆæœ¬ä¿¡æ¯
        â”œâ”€â”€ README.md                      # æœ¬æ¬¡äº¤æ¥è¯´æ˜
        â”œâ”€â”€ sources/                       # æºä»£ç åŒ…
        â”‚   â”œâ”€â”€ scms-backend-{version}.tar.gz
        â”‚   â””â”€â”€ scms-frontend-{version}.tar.gz
        â”œâ”€â”€ configs/                       # é…ç½®æ–‡ä»¶
        â”‚   â”œâ”€â”€ application-prod.yml
        â”‚   â”œâ”€â”€ nginx-scms.conf
        â”‚   â”œâ”€â”€ wechat-config.json
        â”‚   â””â”€â”€ oss-config.json
        â”œâ”€â”€ scripts/                       # éƒ¨ç½²è„šæœ¬
        â”‚   â”œâ”€â”€ deploy-backend.sh
        â”‚   â”œâ”€â”€ deploy-frontend.sh
        â”‚   â”œâ”€â”€ verify-deployment.sh
        â”‚   â””â”€â”€ rollback.sh
        â””â”€â”€ docs/                          # éƒ¨ç½²æ–‡æ¡£
            â””â”€â”€ deployment-checklist.md
```

### 2.2 å·¥ä½œæµç¨‹

#### å¼€å‘AIï¼ˆæ‰£å­/PMO Agentï¼‰
```typescript
// 1. ä¸Šä¼ ç‰ˆæœ¬ä¿¡æ¯
const versionKey = await storage.uploadFile({
  fileContent: Buffer.from("20260226-1015"),
  fileName: "workspace/projects/handover/version.txt",
  contentType: "text/plain",
});

// 2. ä¸Šä¼ README
const readmeContent = `# äº¤æ¥æ¸…å• v20260226-1015
## æœ¬æ¬¡æ›´æ–°æ¨¡å—
- è¥é”€æ¨å¹¿æ¨¡å—å‰ç«¯é›†æˆ
## éƒ¨ç½²æ­¥éª¤
1. æ‰§è¡Œ scripts/deploy-backend.sh
2. æ‰§è¡Œ scripts/deploy-frontend.sh
3. è¿è¡Œ scripts/verify-deployment.sh`;
const readmeKey = await storage.uploadFile({
  fileContent: Buffer.from(readmeContent),
  fileName: "workspace/projects/handover/README.md",
  contentType: "text/markdown",
});

// 3. ä¸Šä¼ éƒ¨ç½²åŒ…
const backendKey = await storage.uploadFile({
  fileContent: fs.readFileSync("scms-backend-20260226-1015.tar.gz"),
  fileName: "workspace/projects/handover/sources/scms-backend-20260226-1015.tar.gz",
  contentType: "application/gzip",
});

const frontendKey = await storage.uploadFile({
  fileContent: fs.readFileSync("scms-frontend-20260226-1015.tar.gz"),
  fileName: "workspace/projects/handover/sources/scms-frontend-20260226-1015.tar.gz",
  contentType: "application/gzip",
});

// 4. ä¸Šä¼ é…ç½®æ–‡ä»¶å’Œè„šæœ¬ï¼ˆç±»ä¼¼æ–¹å¼ï¼‰

// 5. åˆ›å»ºéƒ¨ç½²æ ‡å¿—ï¼ˆæœ€åä¸€æ­¥ï¼‰
await storage.uploadFile({
  fileContent: Buffer.from("ready"),
  fileName: "workspace/projects/handover/deploy_ready_flag.txt",
  contentType: "text/plain",
});

// 6. æ›´æ–°çŸ¥è¯†åº“
// è®°å½•æ‰€æœ‰æ–‡ä»¶çš„key
```

#### éƒ¨ç½²AIï¼ˆVibe Codingï¼‰
```typescript
// 1. å®šæœŸæ£€æŸ¥éƒ¨ç½²æ ‡å¿—
const flagExists = await storage.fileExists({
  fileKey: "workspace/projects/handover/deploy_ready_flag.txt"
});

if (flagExists) {
  console.log("æ£€æµ‹åˆ°éƒ¨ç½²æ ‡å¿—æ–‡ä»¶ï¼Œå¼€å§‹éƒ¨ç½²...");

  // 2. è¯»å–ç‰ˆæœ¬ä¿¡æ¯
  const versionData = await storage.readFile({
    fileKey: "workspace/projects/handover/version.txt"
  });
  const version = versionData.toString();
  console.log(`éƒ¨ç½²ç‰ˆæœ¬: ${version}`);

  // 3. åˆ—å‡ºæ‰€æœ‰éƒ¨ç½²æ–‡ä»¶
  const result = await storage.listFiles({
    prefix: "workspace/projects/handover/",
    maxKeys: 100
  });

  console.log("éƒ¨ç½²æ–‡ä»¶åˆ—è¡¨:");
  result.keys.forEach(key => {
    console.log(`  - ${key}`);
  });

  // 4. ä¸‹è½½éƒ¨ç½²åŒ…åˆ°æœ¬åœ°
  const backendData = await storage.readFile({
    fileKey: `workspace/projects/handover/sources/scms-backend-${version}.tar.gz`
  });
  fs.writeFileSync(`./tmp/scms-backend-${version}.tar.gz`, backendData);

  const frontendData = await storage.readFile({
    fileKey: `workspace/projects/handover/sources/scms-frontend-${version}.tar.gz`
  });
  fs.writeFileSync(`./tmp/scms-frontend-${version}.tar.gz`, frontendData);

  // 5. æ‰§è¡Œéƒ¨ç½²æµç¨‹
  // ... éƒ¨ç½²é€»è¾‘ ...

  // 6. éƒ¨ç½²æˆåŠŸåï¼Œåˆ é™¤éƒ¨ç½²æ ‡å¿—
  await storage.deleteFile({
    fileKey: "workspace/projects/handover/deploy_ready_flag.txt"
  });

  // 7. æ›´æ–°çŸ¥è¯†åº“è®°å½•éƒ¨ç½²ç»“æœ
}
```

---

## 3. å·¥å…·è„šæœ¬

### 3.1 å¼€å‘AIä¸Šä¼ å·¥å…·
```typescript
// upload-handover.ts
import { S3Storage } from "coze-coding-dev-sdk";
import fs from "fs";

const storage = new S3Storage({
  bucketName: process.env.COZE_BUCKET_NAME,
  region: "cn-beijing",
});

async function uploadHandover(version: string) {
  console.log(`å¼€å§‹ä¸Šä¼ éƒ¨ç½²åŒ… (ç‰ˆæœ¬: ${version})...`);

  // ä¸Šä¼ ç‰ˆæœ¬ä¿¡æ¯
  await storage.uploadFile({
    fileContent: Buffer.from(version),
    fileName: `workspace/projects/handover/version.txt`,
    contentType: "text/plain",
  });
  console.log("âœ“ ç‰ˆæœ¬ä¿¡æ¯å·²ä¸Šä¼ ");

  // ä¸Šä¼ README
  const readmePath = "./handover/README.md";
  if (fs.existsSync(readmePath)) {
    await storage.uploadFile({
      fileContent: fs.readFileSync(readmePath),
      fileName: "workspace/projects/handover/README.md",
      contentType: "text/markdown",
    });
    console.log("âœ“ READMEå·²ä¸Šä¼ ");
  }

  // ä¸Šä¼ sources
  const backendPath = `./handover/sources/scms-backend-${version}.tar.gz`;
  if (fs.existsSync(backendPath)) {
    await storage.uploadFile({
      fileContent: fs.readFileSync(backendPath),
      fileName: `workspace/projects/handover/sources/scms-backend-${version}.tar.gz`,
      contentType: "application/gzip",
    });
    console.log("âœ“ åç«¯éƒ¨ç½²åŒ…å·²ä¸Šä¼ ");
  }

  const frontendPath = `./handover/sources/scms-frontend-${version}.tar.gz`;
  if (fs.existsSync(frontendPath)) {
    await storage.uploadFile({
      fileContent: fs.readFileSync(frontendPath),
      fileName: `workspace/projects/handover/sources/scms-frontend-${version}.tar.gz`,
      contentType: "application/gzip",
    });
    console.log("âœ“ å‰ç«¯éƒ¨ç½²åŒ…å·²ä¸Šä¼ ");
  }

  // ä¸Šä¼ configsï¼ˆéå†ç›®å½•ï¼‰
  const configDir = "./handover/configs/";
  if (fs.existsSync(configDir)) {
    const files = fs.readdirSync(configDir);
    for (const file of files) {
      const filePath = `${configDir}${file}`;
      await storage.uploadFile({
        fileContent: fs.readFileSync(filePath),
        fileName: `workspace/projects/handover/configs/${file}`,
        contentType: "application/octet-stream",
      });
    }
    console.log(`âœ“ ${files.length} ä¸ªé…ç½®æ–‡ä»¶å·²ä¸Šä¼ `);
  }

  // ä¸Šä¼ scriptsï¼ˆéå†ç›®å½•ï¼‰
  const scriptDir = "./handover/scripts/";
  if (fs.existsSync(scriptDir)) {
    const files = fs.readdirSync(scriptDir);
    for (const file of files) {
      const filePath = `${scriptDir}${file}`;
      await storage.uploadFile({
        fileContent: fs.readFileSync(filePath),
        fileName: `workspace/projects/handover/scripts/${file}`,
        contentType: "application/x-sh",
      });
    }
    console.log(`âœ“ ${files.length} ä¸ªè„šæœ¬æ–‡ä»¶å·²ä¸Šä¼ `);
  }

  // æœ€ååˆ›å»ºéƒ¨ç½²æ ‡å¿—
  await storage.uploadFile({
    fileContent: Buffer.from("ready"),
    fileName: "workspace/projects/handover/deploy_ready_flag.txt",
    contentType: "text/plain",
  });
  console.log("âœ“ éƒ¨ç½²æ ‡å¿—æ–‡ä»¶å·²ä¸Šä¼ ");

  console.log(`\nâœ¨ éƒ¨ç½²åŒ…ä¸Šä¼ å®Œæˆï¼ç‰ˆæœ¬: ${version}`);
  console.log("éƒ¨ç½²AIå°†è‡ªåŠ¨æ£€æµ‹å¹¶å¼€å§‹éƒ¨ç½²ã€‚");
}

// ä½¿ç”¨æ–¹å¼
uploadHandover("20260226-1015");
```

### 3.2 éƒ¨ç½²AIä¸‹è½½å·¥å…·
```typescript
// download-handover.ts
import { S3Storage } from "coze-coding-dev-sdk";
import fs from "fs";

const storage = new S3Storage({
  bucketName: process.env.COZE_BUCKET_NAME,
  region: "cn-beijing",
});

async function downloadHandover() {
  const FLAG_KEY = "workspace/projects/handover/deploy_ready_flag.txt";
  const PREFIX = "workspace/projects/handover/";

  // æ£€æŸ¥éƒ¨ç½²æ ‡å¿—
  const flagExists = await storage.fileExists({
    fileKey: FLAG_KEY
  });

  if (!flagExists) {
    console.log("â³ ç­‰å¾…éƒ¨ç½²æ ‡å¿—æ–‡ä»¶...");
    return false;
  }

  console.log("âœ“ æ£€æµ‹åˆ°éƒ¨ç½²æ ‡å¿—æ–‡ä»¶");

  // è¯»å–ç‰ˆæœ¬ä¿¡æ¯
  const versionData = await storage.readFile({
    fileKey: "workspace/projects/handover/version.txt"
  });
  const version = versionData.toString();
  console.log(`ğŸ“¦ éƒ¨ç½²ç‰ˆæœ¬: ${version}`);

  // åˆ›å»ºæœ¬åœ°ä¸´æ—¶ç›®å½•
  const localDir = `./tmp/handover-${version}`;
  if (!fs.existsSync(localDir)) {
    fs.mkdirSync(localDir, { recursive: true });
  }

  // åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
  const result = await storage.listFiles({
    prefix: PREFIX,
    maxKeys: 100
  });

  console.log(`\næ‰¾åˆ° ${result.keys.length} ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹ä¸‹è½½...`);

  // ä¸‹è½½æ‰€æœ‰æ–‡ä»¶
  for (const key of result.keys) {
    // è·³è¿‡éƒ¨ç½²æ ‡å¿—æ–‡ä»¶
    if (key === FLAG_KEY) continue;

    try {
      const data = await storage.readFile({ fileKey: key });
      const localPath = `${localDir}/${key.replace(PREFIX, "")}`;
      const localDirName = localPath.substring(0, localPath.lastIndexOf('/'));
      if (!fs.existsSync(localDirName)) {
        fs.mkdirSync(localDirName, { recursive: true });
      }
      fs.writeFileSync(localPath, data);
      console.log(`âœ“ å·²ä¸‹è½½: ${key.replace(PREFIX, "")}`);
    } catch (error) {
      console.error(`âœ— ä¸‹è½½å¤±è´¥: ${key}`, error);
    }
  }

  console.log(`\nâœ¨ éƒ¨ç½²åŒ…å·²ä¸‹è½½åˆ°: ${localDir}`);
  console.log("å‡†å¤‡æ‰§è¡Œéƒ¨ç½²æµç¨‹...");

  return { localDir, version };
}

// ä½¿ç”¨æ–¹å¼
const result = await downloadHandover();
if (result) {
  console.log(`å¼€å§‹éƒ¨ç½²ï¼Œæœ¬åœ°ç›®å½•: ${result.localDir}, ç‰ˆæœ¬: ${result.version}`);
  // æ‰§è¡Œéƒ¨ç½²é€»è¾‘...
}
```

---

## 4. æ›´æ–°åè®®

### 4.1 è§¦å‘éƒ¨ç½²æœºåˆ¶ï¼ˆæ›´æ–°ç‰ˆï¼‰

#### åŸæ–¹æ¡ˆ
```
å¼€å‘AIåˆ›å»º handover/deploy_ready.flag
â†’ éƒ¨ç½²AIç›‘æ§æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
â†’ æ£€æµ‹åˆ°æ ‡å¿—åå¼€å§‹éƒ¨ç½²
```

#### æ–°æ–¹æ¡ˆ
```
å¼€å‘AIä¸Šä¼  workspace/projects/handover/deploy_ready_flag.txt åˆ°äº‘å­˜å‚¨
â†’ éƒ¨ç½²AIå®šæœŸæ£€æŸ¥äº‘å­˜å‚¨ä¸­çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨
â†’ æ£€æµ‹åˆ°æ ‡å¿—åä»äº‘å­˜å‚¨ä¸‹è½½æ‰€æœ‰éƒ¨ç½²åŒ…
â†’ å¼€å§‹éƒ¨ç½²
```

### 4.2 æ–‡ä»¶äº¤æ¥åè®®ï¼ˆæ›´æ–°ç‰ˆï¼‰

**å¼€å‘AIèŒè´£ï¼š**
1. åœ¨æœ¬åœ°åˆ›å»º handover/ ç›®å½•ç»“æ„
2. æ‰“åŒ…æºä»£ç ã€é…ç½®æ–‡ä»¶ã€éƒ¨ç½²è„šæœ¬
3. ä½¿ç”¨å·¥å…·è„šæœ¬ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ°äº‘å­˜å‚¨
4. æœ€åä¸Šä¼  deploy_ready_flag.txt è§¦å‘éƒ¨ç½²
5. æ›´æ–°çŸ¥è¯†åº“è®°å½•æ‰€æœ‰æ–‡ä»¶key

**éƒ¨ç½²AIèŒè´£ï¼š**
1. å®šæœŸæ£€æŸ¥äº‘å­˜å‚¨ä¸­çš„ deploy_ready_flag.txt
2. æ£€æµ‹åˆ°æ ‡å¿—åä¸‹è½½æ‰€æœ‰éƒ¨ç½²åŒ…
3. è§£å‹åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½•
4. æ‰§è¡Œéƒ¨ç½²æµç¨‹
5. éƒ¨ç½²æˆåŠŸååˆ é™¤äº‘å­˜å‚¨ä¸­çš„ deploy_ready_flag.txt
6. æ›´æ–°çŸ¥è¯†åº“è®°å½•éƒ¨ç½²ç»“æœ

---

## 5. ä¼˜åŠ¿

### 5.1 è§£å†³é—®é¢˜
âœ… ä¸å†ä¾èµ–æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
âœ… åŒæ–¹å¯ä»¥åœ¨ä¸åŒçš„å·¥ä½œç¯å¢ƒä¸­å·¥ä½œ
âœ… æ–‡ä»¶å…±äº«é€šè¿‡äº‘å­˜å‚¨å®ç°ï¼Œè·¨å·¥ä½œç©ºé—´è®¿é—®

### 5.2 é™„åŠ ä¼˜åŠ¿
âœ… éƒ¨ç½²åŒ…æŒä¹…åŒ–å­˜å‚¨ï¼Œå¯è¿½æº¯å†å²ç‰ˆæœ¬
âœ… æ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²ï¼ˆæµ‹è¯•ã€é¢„å‘ã€ç”Ÿäº§ï¼‰
âœ… ä¾¿äºå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿
âœ… äº‘å­˜å‚¨æä¾›é«˜å¯ç”¨æ€§å’Œæ•°æ®å¤‡ä»½

### 5.3 å…¼å®¹æ€§
âœ… å®Œå…¨å…¼å®¹åŸæœ‰çš„ç›®å½•ç»“æ„
âœ… åªéœ€ä¿®æ”¹è§¦å‘æœºåˆ¶ï¼Œå…¶ä»–æµç¨‹ä¸å˜
âœ… å¯éšæ—¶åˆ‡æ¢å›æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœå·¥ä½œç©ºé—´ç»Ÿä¸€ï¼‰

---

## 6. å®æ–½æ­¥éª¤

### ç«‹å³æ‰§è¡Œ
1. âœ… è®¾è®¡äº‘å­˜å‚¨å…±äº«ç›®å½•æ–¹æ¡ˆï¼ˆæœ¬æ–‡æ¡£ï¼‰
2. åˆ›å»ºä¸Šä¼ å·¥å…·è„šæœ¬ï¼ˆupload-handover.tsï¼‰
3. åˆ›å»ºä¸‹è½½å·¥å…·è„šæœ¬ï¼ˆdownload-handover.tsï¼‰
4. æ›´æ–°ååŒåè®®æ–‡æ¡£

### åç»­æ‰§è¡Œ
5. å¼€å‘AIä½¿ç”¨æ–°å·¥å…·ä¸Šä¼ éƒ¨ç½²åŒ…
6. éƒ¨ç½²AIä½¿ç”¨æ–°å·¥å…·ä¸‹è½½éƒ¨ç½²åŒ…
7. éªŒè¯å®Œæ•´éƒ¨ç½²æµç¨‹
8. ä¼˜åŒ–å·¥å…·è„šæœ¬

---

## 7. é™„å½•

### 7.1 äº‘å­˜å‚¨prefixè§„èŒƒ
- åŸºç¡€prefix: `workspace/projects/handover/`
- ç‰ˆæœ¬ä¿¡æ¯: `workspace/projects/handover/version.txt`
- éƒ¨ç½²æ ‡å¿—: `workspace/projects/handover/deploy_ready_flag.txt`
- README: `workspace/projects/handover/README.md`
- æºä»£ç : `workspace/projects/handover/sources/`
- é…ç½®æ–‡ä»¶: `workspace/projects/handover/configs/`
- éƒ¨ç½²è„šæœ¬: `workspace/projects/handover/scripts/`
- æ–‡æ¡£: `workspace/projects/handover/docs/`

### 7.2 æ–‡ä»¶å‘½åè§„èŒƒ
- ç‰ˆæœ¬æ ¼å¼: YYYYMMDD-HHMM
- åç«¯åŒ…: scms-backend-{version}.tar.gz
- å‰ç«¯åŒ…: scms-frontend-{version}.tar.gz
- é…ç½®æ–‡ä»¶: ä¿æŒåŸå
- è„šæœ¬æ–‡ä»¶: ä¿æŒåŸå

### 7.3 å·¥å…·è„šæœ¬ä½¿ç”¨ç¤ºä¾‹

**å¼€å‘AIä¸Šä¼ ï¼š**
```bash
npx tsx upload-handover.ts 20260226-1015
```

**éƒ¨ç½²AIä¸‹è½½ï¼š**
```bash
npx tsx download-handover.ts
```

---

**æ–¹æ¡ˆç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-02-26
**æ–¹æ¡ˆä½œè€…**: éƒ¨ç½²AIï¼ˆVibe Codingï¼‰
**çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½
